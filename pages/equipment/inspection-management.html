<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‚¹å·¡æ£€ç®¡ç† - è®¾å¤‡ç®¡ç† - æ•°å­—å·¥å‚ä¸€ä½“åŒ–å¹³å°</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- FontAwesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary': '#f59e0b',
                        'primary-light': '#fbbf24',
                        'secondary': '#6b7280',
                        'success': '#10b981',
                        'warning': '#f59e0b',
                        'danger': '#ef4444'
                    }
                }
            }
        }
    </script>
    <style>
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tab-button {
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab-button.active {
            border-bottom-color: #f59e0b;
            color: #d97706;
            font-weight: 600;
        }

        .status-chip {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .route-card {
            padding: 1rem;
            border-radius: 0.75rem;
            border: 1px solid #e5e7eb;
            background-color: #ffffff;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .route-card:hover {
            border-color: #fbbf24;
            background-color: #fffbeb;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.35rem;
            padding: 0.25rem 0.6rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .scrollbar-thin::-webkit-scrollbar {
            width: 6px;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb {
            background-color: rgba(148, 163, 184, 0.5);
            border-radius: 9999px;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="flex h-screen overflow-hidden">
        <!-- ä¸»å†…å®¹åŒº -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <div class="bg-white border-b p-6">
                <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-6">
                    <div class="flex-1">
                        <div class="flex items-center gap-3 mb-2">
                            <span class="px-3 py-1 bg-orange-100 text-orange-700 rounded-full text-xs font-semibold">ç‚¹å·¡æ£€ç®¡ç†</span>
                            <span class="text-xs text-gray-500">è®¾å¤‡ç®¡ç†éœ€æ±‚æ–‡æ¡£ 4.4èŠ‚ ç¬¬ä¸€é“é˜²çº¿</span>
                        </div>
                        <div class="flex items-center gap-4 mb-2">
                            <h1 id="page-title" class="text-2xl font-bold text-gray-800">å·¡æ£€è·¯çº¿</h1>
                        </div>
                        <p class="text-sm text-gray-600">é«˜é¢‘æ¬¡æ ‡å‡†åŒ–æ£€æŸ¥ï¼ŒåŠæ—¶å‘ç°è®¾å¤‡å¼‚å¸¸å’Œæ½œåœ¨éšæ‚£</p>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        <button onclick="openRouteModal()" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-orange-600 transition-colors flex items-center">
                            <i class="fas fa-plus mr-2"></i>æ–°å»ºè·¯çº¿
                        </button>
                        <button onclick="openPlanModal()" class="px-4 py-2 bg-success text-white rounded-lg hover:bg-green-700 transition-colors flex items-center">
                            <i class="fas fa-calendar-plus mr-2"></i>æ–°å»ºè®¡åˆ’
                        </button>
                        <button onclick="openTaskModal()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center">
                            <i class="fas fa-play mr-2"></i>å¼€å§‹å·¡æ£€
                        </button>
                        <button onclick="showAbnormalReportModal()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors flex items-center">
                            <i class="fas fa-exclamation-triangle mr-2"></i>ä¸€é”®ä¸ŠæŠ¥
                        </button>
                        <button onclick="exportData()" class="px-4 py-2 bg-secondary text-white rounded-lg hover:bg-gray-700 transition-colors flex items-center">
                            <i class="fas fa-download mr-2"></i>å¯¼å‡º
                        </button>
                    </div>
                </div>

                <!-- ç»Ÿè®¡å¡ç‰‡ -->
                <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4">
                    <div class="bg-orange-50 border border-orange-200 rounded-lg p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-orange-600 font-medium">ä»Šæ—¥ä»»åŠ¡</p>
                                <p id="metric-today-tasks" class="text-2xl font-bold text-orange-700">24</p>
                                <p class="text-xs text-orange-500 mt-1">å®Œæˆç‡ 92%</p>
                            </div>
                            <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-clipboard-check text-2xl text-orange-600"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-green-600 font-medium">å·²å®Œæˆ</p>
                                <p id="metric-completed" class="text-2xl font-bold text-green-700">22</p>
                                <p class="text-xs text-green-500 mt-1">æŒ‰æ—¶å®Œæˆ</p>
                            </div>
                            <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-check-circle text-2xl text-green-600"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-yellow-600 font-medium">è¿›è¡Œä¸­</p>
                                <p id="metric-in-progress" class="text-2xl font-bold text-yellow-700">2</p>
                                <p class="text-xs text-yellow-500 mt-1">å®æ—¶è·Ÿè¸ª</p>
                            </div>
                            <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-spinner text-2xl text-yellow-600"></i>
                            </div>
                        </div>
                    </div>

                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-red-600 font-medium">å‘ç°å¼‚å¸¸</p>
                                <p id="metric-abnormal" class="text-2xl font-bold text-red-700">3</p>
                                <p class="text-xs text-red-500 mt-1">éœ€è¦å¤„ç†</p>
                            </div>
                            <button onclick="showAbnormalReportModal()" class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center hover:bg-red-200 transition-all duration-200" title="ä¸€é”®ä¸ŠæŠ¥å¼‚å¸¸">
                                <i class="fas fa-exclamation-triangle text-2xl text-red-600"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç­›é€‰å™¨ -->
            <div class="bg-white border-b px-6 py-4">
                <div class="flex flex-wrap gap-4">
                    <div class="flex-1 min-w-[200px]">
                        <input type="text" id="search-input" placeholder="æœç´¢è·¯çº¿ã€è®¡åˆ’ã€ä»»åŠ¡..." 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                               onkeyup="applyFilters()">
                    </div>
                    <select id="filter-status" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" onchange="applyFilters()">
                        <option value="">å…¨éƒ¨çŠ¶æ€</option>
                        <option value="pending">å¾…æ‰§è¡Œ</option>
                        <option value="in_progress">è¿›è¡Œä¸­</option>
                        <option value="completed">å·²å®Œæˆ</option>
                        <option value="abnormal">å‘ç°å¼‚å¸¸</option>
                    </select>
                    <select id="filter-assignee" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" onchange="applyFilters()">
                        <option value="">å…¨éƒ¨äººå‘˜</option>
                        <option value="æå¸ˆå‚…">æå¸ˆå‚…</option>
                        <option value="ç‹å¸ˆå‚…">ç‹å¸ˆå‚…</option>
                        <option value="é™ˆå¸ˆå‚…">é™ˆå¸ˆå‚…</option>
                        <option value="åˆ˜å¸ˆå‚…">åˆ˜å¸ˆå‚…</option>
                    </select>
                    <input type="date" id="filter-date" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" onchange="applyFilters()">
                    <button onclick="resetFilters()" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors">
                        <i class="fas fa-redo mr-2"></i>é‡ç½®
                    </button>
                </div>
            </div>

            <!-- ä¸»å†…å®¹åŒº -->
            <div class="flex-1 overflow-auto p-6">
                <!-- è·¯çº¿è§†å›¾ -->
                <div id="routes-view" class="view-content">
                    <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4" id="routes-container">
                        <!-- è·¯çº¿å¡ç‰‡å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>

                <!-- è®¡åˆ’è§†å›¾ -->
                <div id="plans-view" class="view-content hidden">
                    <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">è®¡åˆ’åç§°</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">å…³è”è·¯çº¿</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ‰§è¡Œé¢‘ç‡</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ‰§è¡Œäººå‘˜</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">çŠ¶æ€</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="plans-tbody" class="bg-white divide-y divide-gray-200">
                                <!-- è®¡åˆ’è¡Œå°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- ä»»åŠ¡è§†å›¾ -->
                <div id="tasks-view" class="view-content hidden">
                    <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ä»»åŠ¡ç¼–å·</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">å·¡æ£€è·¯çº¿</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ‰§è¡Œäºº</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">è®¡åˆ’æ—¶é—´</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">å®é™…æ—¶é—´</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ£€æŸ¥ç‚¹</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">å¼‚å¸¸æ•°</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">çŠ¶æ€</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="tasks-tbody" class="bg-white divide-y divide-gray-200">
                                <!-- ä»»åŠ¡è¡Œå°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- æŠ¥å‘Šè§†å›¾ -->
                <div id="reports-view" class="view-content hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- å¼‚å¸¸ç»Ÿè®¡ -->
                        <div class="bg-white rounded-lg shadow-sm p-6">
                            <h3 class="text-lg font-semibold mb-4">å¼‚å¸¸ç»Ÿè®¡åˆ†æ</h3>
                            <div class="space-y-4" id="abnormal-stats">
                                <!-- å¼‚å¸¸ç»Ÿè®¡å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>

                        <!-- å‚æ•°è¶‹åŠ¿ -->
                        <div class="bg-white rounded-lg shadow-sm p-6">
                            <h3 class="text-lg font-semibold mb-4">å‚æ•°è¶‹åŠ¿åˆ†æ</h3>
                            <div class="space-y-4" id="trend-charts">
                                <!-- è¶‹åŠ¿å›¾å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- è·¯çº¿æ¨¡æ€çª—å£ -->
    <div id="route-modal" class="modal">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-auto">
            <div class="flex items-center justify-between p-6 border-b">
                <h3 class="text-xl font-semibold">æ–°å»ºå·¡æ£€è·¯çº¿</h3>
                <button onclick="closeModal('route-modal')" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="p-6">
                <form id="route-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">è·¯çº¿åç§° *</label>
                        <input type="text" id="route-name" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">è·¯çº¿æè¿°</label>
                        <textarea id="route-description" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">è®¾å¤‡ç‚¹ä½ *</label>
                        <div id="equipment-points" class="space-y-2">
                            <div class="flex gap-2">
                                <input type="text" placeholder="è®¾å¤‡åç§°" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg">
                                <input type="text" placeholder="æ£€æŸ¥é¡¹ç›®" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg">
                                <button type="button" onclick="addEquipmentPoint()" class="px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">é¢„è®¡æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰</label>
                        <input type="number" id="route-duration" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" value="30">
                    </div>
                </form>
            </div>
            <div class="flex justify-end gap-3 p-6 border-t bg-gray-50">
                <button onclick="closeModal('route-modal')" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">å–æ¶ˆ</button>
                <button onclick="saveRoute()" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-orange-600">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- è®¡åˆ’æ¨¡æ€çª—å£ -->
    <div id="plan-modal" class="modal">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-auto">
            <div class="flex items-center justify-between p-6 border-b">
                <h3 class="text-xl font-semibold">æ–°å»ºå·¡æ£€è®¡åˆ’</h3>
                <button onclick="closeModal('plan-modal')" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="p-6">
                <form id="plan-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">è®¡åˆ’åç§° *</label>
                        <input type="text" id="plan-name" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">å…³è”è·¯çº¿ *</label>
                        <select id="plan-route" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" required>
                            <option value="">è¯·é€‰æ‹©è·¯çº¿</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">æ‰§è¡Œé¢‘ç‡ *</label>
                        <select id="plan-frequency" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" required>
                            <option value="daily">æ¯æ—¥</option>
                            <option value="weekly">æ¯å‘¨</option>
                            <option value="monthly">æ¯æœˆ</option>
                            <option value="shift">æ¯ç­æ¬¡</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">æ‰§è¡Œäººå‘˜ *</label>
                        <select id="plan-assignee" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" required>
                            <option value="">è¯·é€‰æ‹©äººå‘˜</option>
                            <option value="æå¸ˆå‚…">æå¸ˆå‚…</option>
                            <option value="ç‹å¸ˆå‚…">ç‹å¸ˆå‚…</option>
                            <option value="é™ˆå¸ˆå‚…">é™ˆå¸ˆå‚…</option>
                            <option value="åˆ˜å¸ˆå‚…">åˆ˜å¸ˆå‚…</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">å¼€å§‹æ—¥æœŸ</label>
                        <input type="date" id="plan-start-date" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
                    </div>
                </form>
            </div>
            <div class="flex justify-end gap-3 p-6 border-t bg-gray-50">
                <button onclick="closeModal('plan-modal')" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">å–æ¶ˆ</button>
                <button onclick="savePlan()" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-orange-600">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- ä»»åŠ¡è¯¦æƒ…æ¨¡æ€çª—å£ -->
    <div id="task-detail-modal" class="modal">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-auto">
            <div class="flex items-center justify-between p-6 border-b">
                <h3 class="text-xl font-semibold">å·¡æ£€ä»»åŠ¡è¯¦æƒ…</h3>
                <button onclick="closeModal('task-detail-modal')" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div class="p-6" id="task-detail-content">
                <!-- ä»»åŠ¡è¯¦æƒ…å†…å®¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
            <div class="flex justify-end gap-3 p-6 border-t bg-gray-50">
                <button onclick="closeModal('task-detail-modal')" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300">å…³é—­</button>
            </div>
        </div>
    </div>

    <!-- å¼‚å¸¸ä¸€é”®ä¸ŠæŠ¥æ¨¡æ€çª—å£ -->
    <div id="abnormal-report-modal" class="modal">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-3xl max-h-[90vh] overflow-auto">
            <div class="flex items-center justify-between p-6 border-b">
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center mr-3">
                        <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
                    </div>
                    <h3 class="text-xl font-semibold">å·¡æ£€å¼‚å¸¸ä¸€é”®ä¸ŠæŠ¥</h3>
                </div>
                <button onclick="closeModal('abnormal-report-modal')" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <!-- å¼‚å¸¸æ•°æ®åˆ—è¡¨ -->
            <div class="p-6">
                <div class="mb-4 flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <span class="text-sm text-gray-600">å…±æ£€æµ‹åˆ° <span class="font-bold text-red-600">3</span> æ¡å¼‚å¸¸</span>
                        <button onclick="selectAllAbnormals()" class="text-sm text-orange-600 hover:text-orange-700">
                            <i class="fas fa-check-square mr-1"></i>å…¨é€‰
                        </button>
                    </div>
                    <select class="px-3 py-2 border border-gray-300 rounded-lg text-sm">
                        <option>å…¨éƒ¨å¼‚å¸¸ç±»å‹</option>
                        <option>è®¾å¤‡æ•…éšœ</option>
                        <option>å‚æ•°å¼‚å¸¸</option>
                        <option>å®‰å…¨éšæ‚£</option>
                        <option>å…¶ä»–å¼‚å¸¸</option>
                    </select>
                </div>

                <div class="space-y-3 max-h-96 overflow-y-auto">
                    <!-- å¼‚å¸¸é¡¹1 -->
                    <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors">
                        <div class="flex items-start">
                            <input type="checkbox" class="abnormal-checkbox mt-1 mr-3 w-4 h-4 text-orange-600" checked data-device="æ¶‚è¦†æœº-01" data-abnormal-id="INS-2024-003">
                            <div class="flex-1">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="flex items-center">
                                        <span class="font-medium text-gray-800">INS-2024-003</span>
                                        <span class="ml-2 px-2 py-0.5 bg-red-100 text-red-800 text-xs rounded-full">å‘ç°å¼‚å¸¸</span>
                                        <span class="ml-2 px-2 py-0.5 bg-purple-100 text-purple-800 text-xs rounded-full">
                                            <i class="fas fa-robot mr-1"></i>é«˜ç½®ä¿¡åº¦
                                        </span>
                                    </div>
                                    <span class="text-xs text-gray-500">ä»Šå¤© 14:00</span>
                                </div>
                                <div class="text-sm text-gray-600 mb-2">
                                    <i class="fas fa-route mr-2 text-gray-400"></i>
                                    ä»»åŠ¡: ä¸€å·è½¦é—´ä¸­åˆå·¡æ£€ä»»åŠ¡ | æ‰§è¡Œäºº: ææ˜æ˜
                                </div>
                                <div class="text-sm text-gray-700 mb-2">
                                    <i class="fas fa-info-circle mr-2 text-red-600"></i>
                                    è®¾å¤‡: æ¶‚è¦†æœº-01 | å¼‚å¸¸: æ¸©åº¦è¶…è¿‡å®‰å…¨é˜ˆå€¼200â„ƒ,å½“å‰æ¸©åº¦215â„ƒ
                                </div>
                                <div class="flex items-center justify-between mt-3 pt-3 border-t border-gray-100">
                                    <div class="text-xs text-gray-500">
                                        <i class="fas fa-lightbulb mr-1 text-yellow-500"></i>
                                        AIå»ºè®®: ç«‹å³åœæœºæ£€æŸ¥æ¸©æ§ç³»ç»Ÿ,æ›´æ¢æ¸©åº¦ä¼ æ„Ÿå™¨
                                    </div>
                                    <button onclick="createMaintenanceOrder('INS-2024-003', 'æ¶‚è¦†æœº-01')" class="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm">
                                        <i class="fas fa-wrench mr-1"></i>åˆ›å»ºç»´ä¿®å·¥å•
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- å¼‚å¸¸é¡¹2 -->
                    <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors">
                        <div class="flex items-start">
                            <input type="checkbox" class="abnormal-checkbox mt-1 mr-3 w-4 h-4 text-orange-600" checked data-device="å‹åŠ›æœº-02" data-abnormal-id="INS-2024-002">
                            <div class="flex-1">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="flex items-center">
                                        <span class="font-medium text-gray-800">INS-2024-002</span>
                                        <span class="ml-2 px-2 py-0.5 bg-red-100 text-red-800 text-xs rounded-full">å‘ç°å¼‚å¸¸</span>
                                        <span class="ml-2 px-2 py-0.5 bg-purple-100 text-purple-800 text-xs rounded-full">
                                            <i class="fas fa-robot mr-1"></i>é«˜ç½®ä¿¡åº¦
                                        </span>
                                    </div>
                                    <span class="text-xs text-gray-500">ä»Šå¤© 10:00</span>
                                </div>
                                <div class="text-sm text-gray-600 mb-2">
                                    <i class="fas fa-route mr-2 text-gray-400"></i>
                                    ä»»åŠ¡: äºŒå·è½¦é—´æ—©ç­å·¡æ£€ | æ‰§è¡Œäºº: ç‹å¸ˆå‚…
                                </div>
                                <div class="text-sm text-gray-700 mb-2">
                                    <i class="fas fa-info-circle mr-2 text-red-600"></i>
                                    è®¾å¤‡: å‹åŠ›æœº-02 | å¼‚å¸¸: æ¶²å‹ç³»ç»Ÿå‹åŠ›ä¸ç¨³å®š,å­˜åœ¨æ³„æ¼é£é™©
                                </div>
                                <div class="flex items-center justify-between mt-3 pt-3 border-t border-gray-100">
                                    <div class="text-xs text-gray-500">
                                        <i class="fas fa-lightbulb mr-1 text-yellow-500"></i>
                                        AIå»ºè®®: æ£€æŸ¥æ¶²å‹æ²¹è·¯å¯†å°ä»¶,é¢„è®¡éœ€æ›´æ¢Oå‹åœˆ
                                    </div>
                                    <button onclick="createMaintenanceOrder('INS-2024-002', 'å‹åŠ›æœº-02')" class="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm">
                                        <i class="fas fa-wrench mr-1"></i>åˆ›å»ºç»´ä¿®å·¥å•
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- å¼‚å¸¸é¡¹3 -->
                    <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors">
                        <div class="flex items-start">
                            <input type="checkbox" class="abnormal-checkbox mt-1 mr-3 w-4 h-4 text-orange-600" checked data-device="ä¼ é€å¸¦-03" data-abnormal-id="INS-2024-001">
                            <div class="flex-1">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="flex items-center">
                                        <span class="font-medium text-gray-800">INS-2024-001</span>
                                        <span class="ml-2 px-2 py-0.5 bg-red-100 text-red-800 text-xs rounded-full">å‘ç°å¼‚å¸¸</span>
                                        <span class="ml-2 px-2 py-0.5 bg-yellow-100 text-yellow-800 text-xs rounded-full">
                                            <i class="fas fa-chart-line mr-1"></i>RULé¢„è­¦
                                        </span>
                                    </div>
                                    <span class="text-xs text-gray-500">æ˜¨å¤© 16:30</span>
                                </div>
                                <div class="text-sm text-gray-600 mb-2">
                                    <i class="fas fa-route mr-2 text-gray-400"></i>
                                    ä»»åŠ¡: ä¸‰å·è½¦é—´æ™šç­å·¡æ£€ | æ‰§è¡Œäºº: é™ˆå¸ˆå‚…
                                </div>
                                <div class="text-sm text-gray-700 mb-2">
                                    <i class="fas fa-info-circle mr-2 text-red-600"></i>
                                    è®¾å¤‡: ä¼ é€å¸¦-03 | å¼‚å¸¸: ç”µæœºå¼‚å“,ç–‘ä¼¼è½´æ‰¿ç£¨æŸ
                                </div>
                                <div class="flex items-center justify-between mt-3 pt-3 border-t border-gray-100">
                                    <div class="text-xs text-gray-500">
                                        <i class="fas fa-lightbulb mr-1 text-yellow-500"></i>
                                        AIå»ºè®®: è½´æ‰¿å‰©ä½™å¯¿å‘½çº¦7å¤©,å»ºè®®æå‰æ›´æ¢6205å‹å·è½´æ‰¿
                                    </div>
                                    <button onclick="createMaintenanceOrder('INS-2024-001', 'ä¼ é€å¸¦-03')" class="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm">
                                        <i class="fas fa-wrench mr-1"></i>åˆ›å»ºç»´ä¿®å·¥å•
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ä¸ŠæŠ¥ä¿¡æ¯ -->
            <div class="px-6 pb-6 space-y-4">
                <div class="border-t border-gray-200 pt-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">ä¸ŠæŠ¥çº§åˆ«</label>
                    <div class="flex space-x-3">
                        <label class="flex items-center">
                            <input type="radio" name="abnormalReportLevel" value="low" class="mr-2">
                            <span class="text-sm text-gray-700">æé†’</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="abnormalReportLevel" value="medium" class="mr-2" checked>
                            <span class="text-sm text-gray-700">è­¦å‘Š</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="abnormalReportLevel" value="high" class="mr-2">
                            <span class="text-sm text-gray-700">ä¸¥é‡</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="abnormalReportLevel" value="critical" class="mr-2">
                            <span class="text-sm text-gray-700">è‡´å‘½</span>
                        </label>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">ä¸ŠæŠ¥å¯¹è±¡</label>
                    <select id="abnormal-report-target" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500">
                        <option>è®¾å¤‡ç®¡ç†éƒ¨é—¨</option>
                        <option>ç”Ÿäº§è°ƒåº¦ä¸­å¿ƒ</option>
                        <option>ç»´ä¿®ç­ç»„</option>
                        <option>è½¦é—´ä¸»ç®¡</option>
                        <option>å®‰å…¨ç®¡ç†éƒ¨é—¨</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">å¤‡æ³¨è¯´æ˜</label>
                    <textarea id="abnormal-report-notes" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500" rows="3" placeholder="è¯·è¾“å…¥è¡¥å……è¯´æ˜ä¿¡æ¯(å¯é€‰)"></textarea>
                </div>
            </div>

            <div class="p-6 border-t border-gray-200 bg-gray-50 flex justify-between items-center">
                <div class="text-sm text-gray-600">
                    å·²é€‰æ‹© <span id="abnormal-selected-count" class="font-bold text-orange-600">3</span> æ¡å¼‚å¸¸
                </div>
                <div class="flex space-x-3">
                    <button onclick="closeModal('abnormal-report-modal')" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100">
                        å–æ¶ˆ
                    </button>
                    <button onclick="submitAbnormalReport()" class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                        <i class="fas fa-paper-plane mr-2"></i>
                        ç«‹å³ä¸ŠæŠ¥
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="../../assets/js/equipment-inspection.js"></script>
    <script>
        // æ˜¾ç¤ºå¼‚å¸¸ä¸ŠæŠ¥æ¨¡æ€æ¡†
        function showAbnormalReportModal() {
            document.getElementById('abnormal-report-modal').classList.add('show');
        }

        // å…¨é€‰å¼‚å¸¸
        function selectAllAbnormals() {
            const checkboxes = document.querySelectorAll('.abnormal-checkbox');
            const allChecked = Array.from(checkboxes).every(cb => cb.checked);
            checkboxes.forEach(cb => cb.checked = !allChecked);
            updateAbnormalSelectedCount();
        }

        // æ›´æ–°å·²é€‰æ‹©æ•°é‡
        function updateAbnormalSelectedCount() {
            const checkboxes = document.querySelectorAll('.abnormal-checkbox');
            const checkedCount = Array.from(checkboxes).filter(cb => cb.checked).length;
            const countElement = document.getElementById('abnormal-selected-count');
            if (countElement) {
                countElement.textContent = checkedCount;
            }
        }

        // æäº¤å¼‚å¸¸ä¸ŠæŠ¥
        function submitAbnormalReport() {
            const checkboxes = document.querySelectorAll('.abnormal-checkbox');
            const checkedCount = Array.from(checkboxes).filter(cb => cb.checked).length;
            
            if (checkedCount === 0) {
                alert('è¯·è‡³å°‘é€‰æ‹©ä¸€æ¡å¼‚å¸¸è¿›è¡Œä¸ŠæŠ¥ï¼');
                return;
            }

            const reportLevel = document.querySelector('input[name="abnormalReportLevel"]:checked').value;
            const reportTarget = document.getElementById('abnormal-report-target').value;
            const notes = document.getElementById('abnormal-report-notes').value;
            
            // æ¨¡æ‹Ÿä¸ŠæŠ¥æˆåŠŸ
            alert(`æˆåŠŸä¸ŠæŠ¥ ${checkedCount} æ¡å·¡æ£€å¼‚å¸¸ï¼\nä¸ŠæŠ¥çº§åˆ«: ${reportLevel}\nä¸ŠæŠ¥å¯¹è±¡: ${reportTarget}`);
            closeModal('abnormal-report-modal');
        }

        // ç›‘å¬å¤é€‰æ¡†å˜åŒ–
        document.addEventListener('change', function(e) {
            if (e.target.classList.contains('abnormal-checkbox')) {
                updateAbnormalSelectedCount();
            }
        });

        // åˆ›å»ºç»´ä¿®å·¥å• - æ™ºèƒ½å·¥å•è§¦å‘
        function createMaintenanceOrder(abnormalId, deviceName) {
            // è·å–å¼‚å¸¸ä¿¡æ¯
            const checkbox = document.querySelector(`input[data-abnormal-id="${abnormalId}"]`);
            if (!checkbox) {
                alert('æ— æ³•è·å–å¼‚å¸¸ä¿¡æ¯');
                return;
            }

            // æ¨¡æ‹ŸAIåˆ†æç»“æœ
            const aiAnalysis = {
                'INS-2024-003': {
                    faultPart: 'æ¸©æ§ç³»ç»Ÿ-æ¸©åº¦ä¼ æ„Ÿå™¨',
                    faultReason: 'ä¼ æ„Ÿå™¨è€åŒ–å¯¼è‡´æ¸©åº¦è¯»æ•°å¼‚å¸¸åé«˜',
                    suggestedAction: 'ç«‹å³åœæœºæ£€æŸ¥æ¸©æ§ç³»ç»Ÿï¼Œæ›´æ¢æ¸©åº¦ä¼ æ„Ÿå™¨',
                    priority: 'ç´§æ€¥',
                    estimatedTime: '2å°æ—¶',
                    requiredParts: ['æ¸©åº¦ä¼ æ„Ÿå™¨ PT100', 'å¯¼çƒ­ç¡…è„‚'],
                    assignTo: 'ç”µæ°”ç»´ä¿®ç­-å¼ å·¥'
                },
                'INS-2024-002': {
                    faultPart: 'æ¶²å‹ç³»ç»Ÿ-å¯†å°ç»„ä»¶',
                    faultReason: 'æ¶²å‹æ²¹è·¯å¯†å°ä»¶è€åŒ–ï¼Œå­˜åœ¨æ³„æ¼é£é™©',
                    suggestedAction: 'æ£€æŸ¥æ¶²å‹æ²¹è·¯å¯†å°ä»¶ï¼Œé¢„è®¡éœ€æ›´æ¢Oå‹åœˆ',
                    priority: 'é«˜',
                    estimatedTime: '4å°æ—¶',
                    requiredParts: ['Oå‹åœˆ NBR-90', 'æ¶²å‹æ²¹ HM46'],
                    assignTo: 'æœºæ¢°ç»´ä¿®ç­-ç‹å¸ˆå‚…'
                },
                'INS-2024-001': {
                    faultPart: 'ç”µæœºè½´æ‰¿',
                    faultReason: 'è½´æ‰¿ç£¨æŸä¸¥é‡ï¼Œå‰©ä½™ä½¿ç”¨å¯¿å‘½çº¦7å¤©',
                    suggestedAction: 'å»ºè®®æå‰æ›´æ¢6205å‹å·è½´æ‰¿ï¼Œé¿å…çªå‘æ•…éšœ',
                    priority: 'ä¸­',
                    estimatedTime: '3å°æ—¶',
                    requiredParts: ['æ·±æ²Ÿçƒè½´æ‰¿ 6205-2RS', 'æ¶¦æ»‘è„‚'],
                    assignTo: 'æœºæ¢°ç»´ä¿®ç­-æå¸ˆå‚…',
                    rulWarning: true,
                    remainingLife: '7å¤©'
                }
            };

            const analysis = aiAnalysis[abnormalId];
            if (!analysis) {
                alert('AIåˆ†ææ•°æ®ä¸å¯ç”¨');
                return;
            }

            // ç”Ÿæˆå·¥å•ç¼–å·
            const workOrderNo = 'WO-' + new Date().getFullYear() + 
                                ('0' + (new Date().getMonth() + 1)).slice(-2) + 
                                ('0' + new Date().getDate()).slice(-2) + 
                                '-' + Math.floor(Math.random() * 1000).toString().padStart(3, '0');

            // æ„å»ºå·¥å•ä¿¡æ¯
            const orderInfo = `
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¤– æ™ºèƒ½é¢„è§æ€§ç»´ä¿®å·¥å•å·²åˆ›å»º
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“‹ å·¥å•ç¼–å·: ${workOrderNo}
ğŸ­ è®¾å¤‡åç§°: ${deviceName}
âš ï¸  å¼‚å¸¸ç¼–å·: ${abnormalId}
ğŸ¯ ä¼˜å…ˆçº§: ${analysis.priority}

â”â”â” AI æ•…éšœåˆ†æ â”â”â”
ğŸ” æ•…éšœéƒ¨ä½: ${analysis.faultPart}
ğŸ“Š æ•…éšœåŸå› : ${analysis.faultReason}
${analysis.rulWarning ? 'â° å‰©ä½™å¯¿å‘½: ' + analysis.remainingLife : ''}

â”â”â” ç»´ä¿®å»ºè®® â”â”â”
ğŸ’¡ å»ºè®®æªæ–½: ${analysis.suggestedAction}
â±ï¸  é¢„è®¡å·¥æ—¶: ${analysis.estimatedTime}
ğŸ”§ æ‰€éœ€å¤‡ä»¶: ${analysis.requiredParts.join('ã€')}

â”â”â” å·¥å•æ´¾å‘ â”â”â”
ğŸ‘· æ´¾å‘ç»™: ${analysis.assignTo}
ğŸ“… åˆ›å»ºæ—¶é—´: ${new Date().toLocaleString('zh-CN')}
ğŸ“± å·²å‘é€é€šçŸ¥: çŸ­ä¿¡ã€APPæ¨é€

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… å·¥å•å·²è‡ªåŠ¨æ´¾å‘ç»™ç»´ä¿®å·¥ç¨‹å¸ˆ
ğŸ“Š å¯åœ¨ã€è®¾å¤‡ç®¡ç†-ç»´ä¿®ç®¡ç†ã€‘ä¸­æŸ¥çœ‹è¯¦æƒ…
            `;

            // æ˜¾ç¤ºå·¥å•ä¿¡æ¯
            if (confirm(orderInfo + '\n\næ˜¯å¦ç¡®è®¤åˆ›å»ºæ­¤ç»´ä¿®å·¥å•ï¼Ÿ')) {
                // æ¨¡æ‹Ÿåˆ›å»ºå·¥å•
                alert('âœ… ç»´ä¿®å·¥å•åˆ›å»ºæˆåŠŸï¼\n\nå·¥å•ç¼–å·: ' + workOrderNo + '\nå·²è‡ªåŠ¨æ´¾å‘ç»™: ' + analysis.assignTo);
                
                // å¯é€‰ï¼šè·³è½¬åˆ°ç»´ä¿®å·¥å•é¡µé¢
                // window.location.href = 'maintenance-management.html?order=' + workOrderNo;
            }
        }
    </script>
</body>
</html>
